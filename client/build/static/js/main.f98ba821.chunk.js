(this["webpackJsonpgithub-repo-helper"]=this["webpackJsonpgithub-repo-helper"]||[]).push([[0],{34:function(e){e.exports=JSON.parse('[{"fullname":"bhubr/react-eslint-prettier-template","description":"React + ESLint + Prettier","icon":"react"},{"fullname":"bhubr/express-eslint-prettier-template","description":"Express + ESLint + Prettier","icon":"nodejs"}]')},36:function(e,t,a){e.exports=a(86)},82:function(e,t,a){},83:function(e,t,a){},86:function(e,t,a){"use strict";a.r(t);a(18);var n=a(0),r=a.n(n),c=a(8),u=a.n(c),o=a(5),s=a(6),l=a(33),i=a.n(l),p=a(12),m=a.n(p);function f(e){var t=e.error;return r.a.createElement("div",{className:"ErrorAlert"},t&&t.message)}var h=Object(n.createContext)({auth:null,setAuth:function(){}}),b=a(1),d=a.n(b),v=a(2),g=m.a.create({baseURL:"https://api.github.com"}),E=sessionStorage.getItem("gh:auth"),O=E?JSON.parse(E):null;O&&(g.defaults.headers.authorization="Bearer ".concat(O.access_token));var N=function(){var e=Object(v.a)(d.a.mark((function e(t,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.get("/orgs/".concat(t,"/teams/").concat(a,"/members")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),x=function(){var e=Object(v.a)(d.a.mark((function e(t,a,n){var r,c,u,s,l,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.split("/"),c=Object(o.a)(r,2),u=c[0],s=c[1],e.next=3,g.post("/repos/".concat(u,"/").concat(s,"/generate"),{owner:t,name:a,private:!1},{headers:{accept:"application/vnd.github.baptiste-preview+json"}});case 3:return l=e.sent,i=l.data,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),j=function(){var e=Object(v.a)(d.a.mark((function e(t){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.get("/repos/".concat(t,"/branches"));case 2:return a=e.sent,n=a.data,e.abrupt("return",n.pop());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(v.a)(d.a.mark((function e(t){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.get("/repos/".concat(t));case 2:return a=e.sent,n=a.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(v.a)(d.a.mark((function e(t){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.get("/repos/".concat(t,"/commits"));case 2:return a=e.sent,n=a.data,e.abrupt("return",n.pop());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(v.a)(d.a.mark((function e(t,a,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.post("/repos/".concat(t,"/git/refs"),{ref:"refs/heads/".concat(a),sha:n}));case 1:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),k=function(){var e=Object(v.a)(d.a.mark((function e(t,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.patch("/repos/".concat(t),{default_branch:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),T=function(){var e=Object(v.a)(d.a.mark((function e(t,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.put("/repos/".concat(t,"/branches/").concat(a,"/protection"),{required_pull_request_reviews:{dismiss_stale_reviews:!1,require_code_owner_reviews:!1,required_approving_review_count:1},enforce_admins:!1,required_status_checks:null,restrictions:null},{headers:{accept:"application/vnd.github.luke-cage-preview+json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),M=function(){var e=Object(v.a)(d.a.mark((function e(t,a,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.put("/repos/".concat(t,"/collaborators/").concat(a),{permission:n?"admin":"push"}));case 1:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),_=function(){var e=Object(v.a)(d.a.mark((function e(){var t,a=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:250,e.abrupt("return",new Promise((function(e){return setTimeout(e,t)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(v.a)(d.a.mark((function e(t,a,n){var r,c,u,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:return r=e.sent,c=r.sha,e.next=6,S(t,"dev",c);case 6:return e.next=8,k(t,"dev");case 8:return e.next=10,j(t);case 10:return u=e.sent,o=u.name,e.next=14,T(t,o);case 14:return e.next=16,T(t,"dev");case 16:return e.next=18,Promise.all(a.map((function(e){return M(t,e,e===n)})));case 18:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),A=function(e){e?g.defaults.headers.authorization="Bearer ".concat(e):delete g.defaults.headers.authorization};function C(){var e=Object(n.useState)(null),t=Object(o.a)(e,2),a=t[0],c=t[1],u=Object(n.useContext)(h),s=u.auth,l=u.setAuth;return r.a.createElement("nav",{className:"AppMenu home-menu pure-menu pure-menu-horizontal"},r.a.createElement("span",{className:"pure-menu-heading"},"RepoHelper"),a&&r.a.createElement(f,{error:a}),r.a.createElement("ul",{className:"pure-menu-list"},s?r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement("span",{className:"AppMenu-signedIn"},r.a.createElement("img",{src:s.avatar_url,alt:s.login}),r.a.createElement("button",{className:"pure-button",type:"button",onClick:function(){l(null),A(""),sessionStorage.removeItem("gh:auth")}},"Logout"))):r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement(i.a,{className:"pure-button",authorizationUrl:"https://github.com/login/oauth/authorize",clientId:"5f50c99117b174c03db8",redirectUri:"https://bhubr.github.io/github-repo-helper/",responseType:"code",buttonText:"GitHub Login",scope:"admin:org repo",onSuccess:function(e){var t=e.code;return m.a.get("".concat("https://githubrepohelper.herokuapp.com","/github/token?code=").concat(t)).then((function(e){return e.data})).then((function(e){l(e),A(e.access_token),sessionStorage.setItem("gh:auth",JSON.stringify(e))}))},onFailure:c}))))}function P(e){var t=e.auth,a=e.orgName,n=e.teamName,c=e.methods,u=c.handleInput,o=c.setTeamMembers,l=c.setStep,i=function(){var e=Object(v.a)(d.a.mark((function e(r){var c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.prev=1,e.next=4,N(a,n);case 4:c=e.sent,!!c.find((function(e){return e.login===t.login}))||c.push({id:t.id,login:t.login}),o(c),s.b.success({title:"Team successfully retrieved",message:'Found team "'.concat(n,'" with ').concat(c.length," members")}),l(2),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),s.b.error({title:"Organization or team not found",message:"Error message: ".concat(e.t0.message)});case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{className:"pure-form pure-form-stacked",onSubmit:i},r.a.createElement("fieldset",null,r.a.createElement("legend",null,r.a.createElement("span",{className:"App-step"},"1"),"Choose org&team"),r.a.createElement("label",{htmlFor:"orgName"},"Org"),r.a.createElement("input",{id:"orgName",name:"orgName",value:a,onChange:u,placeholder:"YourOrg"}),r.a.createElement("label",{htmlFor:"teamName"},"Team"),r.a.createElement("input",{id:"teamName",name:"teamName",value:n,onChange:u,placeholder:"this-awesome-team"}),r.a.createElement("button",{className:"pure-button pure-button-primary"},"Submit")))}var I=a(35);a(82);function L(){return r.a.createElement("div",{className:"lds-roller"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null))}function B(e){var t=e.repoAdmin,a=e.state,c=a.orgName,u=a.repoName,l=a.template,i=a.repoMembers,p=a.teamMembers,m=a.templates,f=e.methods,h=f.handleInput,b=f.handleChangeTemplate,g=f.isRepoMember,E=f.toggleRepoMember,O=f.setStep,N=Object(n.useState)(null),j=Object(o.a)(N,2),y=j[0],S=j[1],k=function(e){return function(t){throw S({loading:!1,level:"error",text:"Error during ".concat(e,": ").concat(t.message)}),t}},T=function(e){return S({loading:!0,level:"loading",text:e})},M=function(){var e=Object(v.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T("Checking template"),e.prev=1,e.next=4,w(t);case 4:a=e.sent,console.log(t,a),s.b.success({title:"Template added",message:'Good news, template "'.concat(t,'" exists!')}),b({label:t,value:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),s.b.error({title:"Template not added",message:'Oops! Template "'.concat(t,'" does not exist!')});case 13:return e.prev=13,S(null),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(v.a)(d.a.mark((function e(a){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,n=l.value,T("Creating repo"),e.next=6,x(c,u,n).catch(k("repo creation"));case 6:return T("Waiting..."),e.next=9,_(5e3);case 9:return T("Post-creation setup"),r="".concat(c,"/").concat(u),e.next=13,R(r,i,t).catch(k("repo post-setup"));case 13:s.b.success({title:"Repo created",message:"Done creating ".concat(r)}),S(null),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),s.b.error({title:"Something bad happened",message:"Repo creation failed!"});case 20:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{className:"pure-form pure-form-stacked",onSubmit:A},r.a.createElement("fieldset",null,r.a.createElement("legend",null,r.a.createElement("span",{className:"App-step"},"2"),"Repo settings",r.a.createElement("button",{type:"button",className:"App-stepBack btn-transparent",onClick:function(){return O(1)}},"Back")),r.a.createElement("div",{className:"pure-g"},r.a.createElement("div",{className:"pure-u-3-5"},r.a.createElement("div",{className:"SettingsRepo-team"},p.map((function(e){return r.a.createElement("label",{className:"SettingsRepo-member",key:e.id},r.a.createElement("input",{htmlFor:"cb-".concat(e.login),type:"checkbox",checked:g(e.login),onChange:function(){return E(e.login)}})," ",r.a.createElement("img",{src:e.avatar_url,alt:e.login}),e.login)})))),r.a.createElement("div",{className:"pure-u-2-5"},r.a.createElement("label",{htmlFor:"repoName"},"Repo name"),r.a.createElement("input",{id:"repoName",name:"repoName",value:u,onChange:h,placeholder:"name"}),r.a.createElement("label",{htmlFor:"template",style:{marginTop:"1.5em"}},"Repo template"),r.a.createElement("p",null,"Select an existing template, or fill in the ",r.a.createElement("code",null,"owner/repository")," template."),r.a.createElement(I.a,{id:"template",isClearable:!0,onCreateOption:M,onChange:b,options:m,value:l}),r.a.createElement("button",{className:"pure-button pure-button-primary",disabled:!u||!l},"Submit"),y&&r.a.createElement("div",{className:"SettingsRepo-status"},y.loading?r.a.createElement(L,null):r.a.createElement("button",{className:"btn-transparent",type:"button",onClick:function(){return S(null)}},"\xd7"),r.a.createElement("span",{className:"SettingsRepo-".concat(y.level,"Status")},y.text))))))}var J=function(e){var t=function(t){var a=sessionStorage.getItem("gh:auth"),c=a?JSON.parse(a):null,u=Object(n.useState)(c),s=Object(o.a)(u,2),l=s[0],i=s[1];return r.a.createElement(h.Provider,{value:{auth:l,setAuth:i}},r.a.createElement(e,t))};return t.displayName="withAuthProvider",t},z=a(17),D=a(13),F=a(3),G=a(34),U=function(e,t){switch(t.type){case"INPUT":var a=t.name,n=t.value;return Object(F.a)(Object(F.a)({},e),{},Object(D.a)({},a,n));case"TEMPLATE":var r=t.template;return Object(F.a)(Object(F.a)({},e),{},{template:r});case"STORE_MEMBERS":var c=t.members;return Object(F.a)(Object(F.a)({},e),{},{teamMembers:c});case"TOGGLE_MEMBER":var u=t.login,o=e.repoMembers.includes(u)?e.repoMembers.filter((function(e){return e!==u})):[].concat(Object(z.a)(e.repoMembers),[u]);return Object(F.a)(Object(F.a)({},e),{},{repoMembers:o});case"SET_STEP":var s=t.step;return Object(F.a)(Object(F.a)({},e),{},{step:s});case"ADD_TEMPLATE":var l={label:t.label,value:t.value},i=[].concat(Object(z.a)(e.templates),[l]);return Object(F.a)(Object(F.a)({},e),{},{templates:i});default:throw new Error("Unknown action ".concat(t.type))}},q=function(){var e=function(){var e,t={step:1,orgName:"",teamName:"",repoPrefix:"",repoName:"",template:null,repoMembers:[],teamMembers:[],templates:(e=G,e.map((function(e){return{value:e.fullname,label:e.description,icon:e.icon}})))},a=sessionStorage.getItem("gh:projdata");if(!a)return t;try{var n=JSON.parse(a);return Object(F.a)(Object(F.a)({},t),n)}catch(r){return t}}(),t=Object(n.useReducer)(U,e),a=Object(o.a)(t,2),r=a[0],c=a[1],u=function(){var e=Object(v.a)(d.a.mark((function e(){var t=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.apply(void 0,t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){!function(e){var t=JSON.stringify(e);sessionStorage.setItem("gh:projdata",t)}(r)}),[r]);return[r,{handleInput:function(e){var t=e.target,a=t.name,n=t.value;return u({type:"INPUT",name:a,value:n})},handleChangeTemplate:function(e){if(null!==e){var t=e.label,a=e.value;t!==a||r.templates.find((function(e){return e.value===a}))||u({type:"ADD_TEMPLATE",label:t,value:a}),u({type:"TEMPLATE",template:e})}else u({type:"TEMPLATE",template:null})},setTeamMembers:function(e){return u({type:"STORE_MEMBERS",members:e})},isRepoMember:function(e){var t;return null===r||void 0===r||null===(t=r.repoMembers)||void 0===t?void 0:t.includes(e)},toggleRepoMember:function(e){return u({type:"TOGGLE_MEMBER",login:e})},setStep:function(e){return u({type:"SET_STEP",step:e})}}]},H=(a(83),function(e){var t=e.children;return r.a.createElement("div",{className:"App"},r.a.createElement(C,null),r.a.createElement("main",{className:"App-inner"},t),r.a.createElement(s.a,null))}),W=function(){return r.a.createElement("div",{className:"Splash"},"Please login!")};var Y=J((function(){var e=q(),t=Object(o.a)(e,2),a=t[0],c=t[1],u=Object(n.useContext)(h).auth,s=a.orgName,l=a.teamName;if(Object(n.useEffect)((function(){}),[u]),!u)return r.a.createElement(H,null,r.a.createElement(W,null));switch(a.step){case 1:return r.a.createElement(H,null,r.a.createElement(P,{auth:u,orgName:s,teamName:l,methods:c}));case 2:return r.a.createElement(H,null,r.a.createElement(B,{repoAdmin:u.login,state:a,methods:c}));default:return r.a.createElement("h1",null,"Error")}}));a(84),a(85);u.a.render(r.a.createElement(Y,null),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.f98ba821.chunk.js.map